

<div id="excess-rentals-in-tfl-bike-sharing" class="section level1">
<h1>Excess rentals in TfL bike sharing</h1>
<p>TfL data: How many bikes were hired every single day:</p>
<pre class="r"><code>url &lt;- &quot;https://data.london.gov.uk/download/number-bicycle-hires/ac29363e-e0cb-47cc-a97a-e216d900a6b0/tfl-daily-cycle-hires.xlsx&quot;</code></pre>
<pre class="r"><code># Use read_excel to read it as dataframe
bike0 &lt;- read_excel(bike.temp,
                   sheet = &quot;Data&quot;,
                   range = cell_cols(&quot;A:B&quot;))

# change dates to get year, month, and week
bike &lt;- bike0 %&gt;% 
  clean_names() %&gt;% 
  rename (bikes_hired = number_of_bicycle_hires) %&gt;% 
  mutate (year = year(day),
          month = lubridate::month(day, label = TRUE),
          week = isoweek(day))</code></pre>
<div id="monthly-changes-in-tfl-bike-rentals" class="section level3">
<h3>Monthly changes in TfL bike rentals:</h3>
<pre class="r"><code># creating a data frame to calculate the monthly average for years 16 to 19
bike_16to19 &lt;- bike %&gt;% 
  filter (year %in% 2016:2019) %&gt;% 
  group_by (month) %&gt;% 
  summarize (avg_bikes_16to19 = mean(bikes_hired))

# creating a data frame to calculate the monthly averages for each year from 17 to 22
bike_17to22 &lt;- bike %&gt;% 
  filter (year %in% 2017:2022) %&gt;% 
  group_by (month, year) %&gt;% 
  summarize (avg_bikes_17to22 = mean(bikes_hired))

# joining the two data frames to create one data frame that can be used for the creation of the graph
joined &lt;- left_join(bike_17to22, bike_16to19)

# plotting monthly changes in TfL bike rentals faceted by year 
ggplot(joined, aes(x = month, group = year)) + 
  geom_line(aes(y = avg_bikes_16to19), group = 1, color = &quot;blue&quot;, size = 1) + 
  geom_line(aes(y = avg_bikes_17to22, group = 1)) + 
  geom_ribbon (aes (ymin = avg_bikes_17to22, ymax = pmax(avg_bikes_16to19, avg_bikes_17to22)), fill = &quot;red&quot;, alpha=0.3) +
  geom_ribbon (aes (ymin = avg_bikes_16to19, ymax = pmax(avg_bikes_16to19, avg_bikes_17to22)), fill = &quot;green&quot;, alpha=0.3) +
  facet_wrap(~ year) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title = &quot;Monthly changes in TfL bike rentals&quot;, 
       subtitle = &quot;Change from monthly average shown in blue and calculated between 2016 - 2019&quot;, 
       x = &quot;&quot;, 
       y = &quot;Bike rentals&quot;, 
       caption = &quot;Source: TfL, London Data Store&quot;) </code></pre>
<p><img src="/blogs/Interesting%20Visualizations_files/figure-html/Monthly%20changes%20in%20TfL%20bike%20rentals-1.png" width="648" style="display: block; margin: auto;" /></p>
</div>
<div id="percentage-changes-from-the-expected-level-of-weekly-rentals" class="section level3">
<h3>Percentage changes from the expected level of weekly rentals:</h3>
<pre class="r"><code># creating a data frame to calculate the weekly average for years 16 to 19
bike_16to19_weekly &lt;- bike %&gt;% 
  filter (year %in% 2016:2019) %&gt;% 
  group_by (week) %&gt;% 
  summarize (avg_bikes_16to19_weekly = mean(bikes_hired))

# creating a data frame to calculate the weekly averages in bike rentals for each year from 17 to 22
bike_17to22_weekly &lt;- bike %&gt;% 
  filter (year %in% 2017:2022) %&gt;% 
  group_by (week, year) %&gt;% 
  summarize (avg_bikes_17to22_weekly = mean(bikes_hired))

# joining the two data frames to create one data frame that can be used for the creation of the graph
joined_weekly &lt;- left_join(bike_17to22_weekly, bike_16to19_weekly)

# adding two columns to calculate the percent change and filter out data value in week 52 of year 2022
joined_weekly_mutated &lt;- joined_weekly %&gt;% 
  mutate (Excess_rentals = avg_bikes_17to22_weekly - avg_bikes_16to19_weekly) %&gt;% 
  mutate (Excess_rentals_Perc = Excess_rentals / avg_bikes_16to19_weekly * 100) %&gt;% 
  filter(!(week &gt;= 52 &amp; year == 2022)) %&gt;% 
  mutate(color_id = if_else(Excess_rentals_Perc &gt; 0,
                          &quot;Positive&quot;,
                          &quot;Negative&quot;)) 

# plotting the weekly percentage changes 
ggplot(joined_weekly_mutated, aes(x = week, y = Excess_rentals_Perc)) + 
  geom_line() + 
  
# creating rectangles to highlight Q2 and Q4
  geom_rect(aes(x = week, xmin = 14, xmax = 26, ymin = -50, ymax = 100), fill = &quot;grey&quot;, alpha = 0.01) + 
  geom_rect(aes(x = week, xmin = 40, xmax = 52, ymin = -50, ymax = 100), fill = &quot;grey&quot;, alpha = 0.01) +
  
  facet_wrap (~ year) +
  theme_bw() +
  
#adding fill in between lines and rug at the bottom
  geom_ribbon(aes(ymin=0, ymax=pmax(Excess_rentals_Perc,0)), fill=&quot;green&quot;, col=&quot;black&quot;, alpha=0.2) +
  geom_ribbon(aes(ymin=pmin(Excess_rentals_Perc,0), ymax=0), fill=&quot;red&quot;, col=&quot;black&quot;, alpha=0.2) + 
  geom_rug(mapping = aes(color = color_id), sides = &quot;b&quot;, show.legend = FALSE) +
  scale_color_manual(values = c(&quot;red&quot;, &quot;green&quot;)) +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  labs(title = &quot;Weekly Changes in TfL bike rentals&quot;, 
       subtitle = &quot;% change from weekly average calculated between 2016 annd 2019&quot;,
       x = &quot;Week&quot;, 
       y = &quot;Bike Rentals&quot;,
       caption = &quot;Source: TfL, London Data Store&quot;)</code></pre>
<p><img src="/blogs/Interesting%20Visualizations_files/figure-html/Weekly%20Changes%20in%20TfL%20bike%20rentals-1.png" width="648" style="display: block; margin: auto;" /></p>
<p>We have chosen the mean to calculate our expected bike rentals because it
allows for a more realistic prediction of future bike rentals. Many
outliers are cause by events such as tube strikes which are not one-off
occurrences and are likely to repeat in the future. Furthermore, the
expected rentals are calculated using data from three years so the
extreme points are softened.</p>
</div>
</div>
<div id="share-of-renewable-energy-production-in-the-world" class="section level1">
<h1>Share of renewable energy production in the world</h1>
<p>Source: The National Bureau of Economic Research (NBER) dataset on the adoption of about 200 technologies in more than 150
countries since 1800. This is the<a href="https://www.nber.org/research/data/cross-country-historical-adoption-technology">Cross-country Historical Adoption of
Technology (CHAT)
dataset</a>.</p>
<p>Load Data:</p>
<pre class="r"><code>technology &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-07-19/technology.csv&#39;)

#get all technologies
labels &lt;- technology %&gt;%
  distinct(variable, label)

# Get country names using &#39;countrycode&#39; package
technology &lt;- technology %&gt;% 
  filter(iso3c != &quot;XCD&quot;) %&gt;% 
  mutate(iso3c = recode(iso3c, &quot;ROM&quot; = &quot;ROU&quot;),
         country = countrycode(iso3c, origin = &quot;iso3c&quot;, destination = &quot;country.name&quot;),
         country = case_when(
           iso3c == &quot;ANT&quot; ~ &quot;Netherlands Antilles&quot;,
           iso3c == &quot;CSK&quot; ~ &quot;Czechoslovakia&quot;,
           iso3c == &quot;XKX&quot; ~ &quot;Kosovo&quot;,
           TRUE           ~ country))

#make smaller dataframe on energy
energy &lt;- technology %&gt;% 
  filter(category == &quot;Energy&quot;)

# download CO2 per capita from World Bank using {wbstats} package
# https://data.worldbank.org/indicator/EN.ATM.CO2E.PC
co2_percap &lt;- wb_data(country = &quot;countries_only&quot;, 
                      indicator = &quot;EN.ATM.CO2E.PC&quot;, 
                      start_date = 1970, 
                      end_date = 2022,
                      return_wide=FALSE) %&gt;% 
  filter(!is.na(value)) %&gt;% 
  #drop unwanted variables
  select(-c(unit, obs_status, footnote, last_updated))

# get a list of countries and their characteristics
# we just want to get the region a country is in and its income level
countries &lt;-  wb_cachelist$countries %&gt;% 
  select(iso3c,region,income_level)</code></pre>
<p>This is a very rich data set, not just for energy and CO2 data, but for
many other technologies. Renewable Contribution is made up of
<code>elec_hydro</code>, <code>elec_solar</code>, <code>elec_wind</code>, and <code>elec_renew_other</code>.</p>
<div id="animation-to-explore-the-relationship-between-co2-per-capita-emissions" class="section level3">
<h3>Animation to explore the relationship between CO2 per capita emissions</h3>
<p>and the deployment of renewables:</p>
<pre class="r"><code>library(gifski)
library(png)

energy[,c(&quot;variable&quot;,&quot;iso3c&quot;,&quot;year&quot;,&quot;value&quot;)] %&gt;% 
  
  #subsetting required rows from energy dataset based on the variable column (types of energy)
  filter(variable %in% c(&quot;elec_hydro&quot;, &quot;elec_solar&quot;, &quot;elec_wind&quot;, &quot;elec_renew_other&quot;,&quot;elecprod&quot;)) %&gt;% 
  
  #pivot wider based on the variable electricity type 
  pivot_wider(names_from = variable, values_from = value) %&gt;% 
  
  #calculate sum of renewable energy and % of renewable contribution to total (elecprod)
  mutate(renewable_energy = elec_hydro + elec_solar + elec_wind + elec_renew_other,
         percent_renewable_contribution = renewable_energy/elecprod) %&gt;% 
  
  #joining with Co2 per capita dataset based on columns iso3c (code) and year: value = CO2 per capita
  inner_join(co2_percap, by = c(&quot;iso3c&quot;, &quot;year&quot; = &quot;date&quot;)) %&gt;% 
  
  #Joining with dataset specifying income level of countries based on col iso3c
  inner_join (countries, by=&quot;iso3c&quot;) %&gt;% 
  
  #Subsetting only required columns
  select(iso3c,country, year, income_level, percent_renewable_contribution, value) %&gt;% 
  rename(CO2_per_cap = value) %&gt;% 
  arrange(desc(percent_renewable_contribution)) %&gt;% 
  
  #Plotting ggplot graph (% renewable contribution vs CO2 per cap)
  ggplot(aes(x=percent_renewable_contribution, y=CO2_per_cap, color=income_level)) +
  geom_point(size=2) +
  scale_x_continuous(labels = scales::percent_format()) +
  facet_wrap(~income_level) +
  theme_bw() +
  theme(legend.position = &quot;none&quot;) +
  labs(title = &#39;Year: {frame_time}&#39;, 
       x = &#39;% renewables&#39;, 
       y = &#39;CO2 per cap&#39;) +
  
  #Animating ggplot graph
  transition_time(as.integer(year)) +
  ease_aes(&#39;linear&#39;)</code></pre>
<p><img src="/blogs/Interesting%20Visualizations_files/figure-html/Creating%20animation%20using%20ggplot-1.gif" style="display: block; margin: auto;" /></p>
<p>General Observations:</p>
<blockquote>
<p>In high income and upper middle income countries, there is a more
pronounced relationship over the years between CO2 per cap reduction
and % renewable increase. Countries in these 2 categories also have
much higher CO2 per cap output than low and lower middle income and
show higher variability in CO2 emissions as seen from the vertical
movement of points in the animation. The lower middle and low income
countries have lower CO2 per capita emissions and we do not see a
change in these emissions as the % of renewable energy change. In the
high income nations, the decrease in CO2 emissions over time could be
a result of the Paris Agreement that was signed in 2015.</p>
<p>Lower income countries are very often developing nations which took
longer to get access to renewable technology. We also note that in the
earlier years we do not have as much data for the low and lower middle
income countries compared to the high and upper middle income nations.</p>
</blockquote>
</div>
</div>
